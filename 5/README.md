# Отчет о выполнении лабораторной работы №5
## Распределение вычислительной нагрузки
### Задание
Модифицировать программы, составленные в Л.Р. №№3,4, распределив вычислительную нагрузку по секциям
(как минимум двумя способами). Измерять время работы программы для тех же значений параметров, что были использованы при выполнении Л.Р. №3. 

#### Выполнение:
Для реализации необходимого количества *секций*, я разбил основную часть работы, поиск максимумов в цикле, на несколько частей - 2, 4 и 8. Работа каждой части (*секции*) не зависит от
других частей, поэтому может выполняться паралелльно с другими. Также, *секции* были добавлены в функцию инициализации массива.

[Код программы](https://github.com/sekibura/Open-MP/blob/master/5/5/Source.cpp)  **<--- КЛИКАБЕЛЬНО**

#### Результат выполнения программы:

##### Вывод для 1000000:
![image](https://user-images.githubusercontent.com/51335422/99804952-d53d3800-2b4c-11eb-8343-84db7baaaf0a.png)


##### Разберем вывод:

Сначала мы видим доказательство того, что многопоточность настроена и функционирует:
```
Max threads= 12
I am ready 0 from 12
I am ready 11 from 12
I am ready 3 from 12
I am ready 8 from 12
I am ready 7 from 12
I am ready 6 from 12
I am ready 10 from 12
I am ready 9 from 12
I am ready 4 from 12
I am ready 5 from 12
I am ready 1 from 12
I am ready 2 from 12
```
------
Далее идет уведомление о окончании инициализации массива и потраченное время:
```
Work took 0.356796 seconds to init
Work took 0.183144 seconds to init (SECTIONS)
```
Видно, что инициализация массива с применением *sections* происходит быстрее.

------
Далее происходит вывод результатов работы функции обработки массивов, время и конечная сумма макимальных элементов. Вывод конечной суммы сделан для проверки правильности работы каждой из функций.
Это результат работы функции без использования OpenMP.
```
C = 49449744
Work took 0.059566 seconds
```
------
Это результат работы функции с  использованем OpenMP, редукцией. Видно, что он превосходит время работы без OpenMP.
```
C_MP = 49449744
Work took 0.010725 seconds MP reduction
```
------

В данном случае массив разделен на две части, работа идет в две *секции*.
```
C = 49449744
Work took 0.093385 seconds  with 2 SECTIONS
```
------

В данном случае массив разделен на четыре части, работа идет в четыре *секции*.
```
C = 49449744
Work took 0.051628 seconds  with 4 SECTIONS
```
------

В данном случае массив разделен на восемь части, работа идет в восемь *секций*.
```
C = 49449744
Work took 0.030513 seconds  with 8 SECTIONS
```
------
|  |  100 | 10 000  | 100 000| 1 000 000| 10 000 000|
|:--------:|---|---| ---|---|---|
| Init   |  0.000057 | 0.004948  | 0.055120   |  0.353106   |  2.936705 |
| Init(sections)  | 0.000037 | 0.002602  |  0.027428  | 0.190573  | 1.512864  |  
| Max  | 0.000011 |  0.000731 |  0.005740   | 0.053689  | 0.439179  | 
| Max(MP reduction)  | 0.000100 | 0.000341  |  0.002132   |0.012447   |  0.098246 |     
| Max (2 sections)  | 0.000048  | 0.001663  |   0.009101   |  0.106002 |  0.711020 |
| Max (4 sections) |  0.000077 |  0.000962 |0.005929  |  0.054529 | 0.422727  |
| Max (8 sections) | 0.000040  | 0.000439  |  0.004189 |  0.030622 | 0.300906  |
------

#### Выводы
~~Исходя из полученных измерений, можно сделать вывод, что нашем случае использование *sections* является излишеством и расточительством ресурсов. Предположу, что данные задачи
слишком тривиальны для использования данной директивы. На создание потоков уходит слишком много времени в масштабах данной задачи. Каждое добавление *секций* прибавляет время к выполнению.
Однако, это не означает, что *секции* не нужны вовсе. Их стоит использовать в более трудоемких задачах, где  время затраченное на создание потока будет незначительно перед полученным усорением в результат использования многопоточности.~~

После проверки кода на *свежую глову*, я обнаружил ошибки, которые приводили к ложным результатам, на основе кокторых были сделаны ложные выводы. Использование *секций* действительно дает прирост скорости выполнения. Однако, на маленьких числах, это не работает.

